#
# {{ ansible_managed }}
#

[Unit]
Description=Systemd service file for Splunk, {{ ansible_managed }}
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
Restart=always
ExecStart={{ splunk_home }}/bin/splunk _internal_launch_under_systemd
KillMode=mixed
KillSignal=SIGINT
TimeoutStopSec=360
LimitNOFILE=65536
LimitRTPRIO=99
SuccessExitStatus=51 52
RestartPreventExitStatus=51
RestartForceExitStatus=52
User={{ splunk_forwarder_user }}
Group={{ splunk_forwarder_group }}
NoNewPrivileges={{ splunk_forwarder_no_new_privileges }}
AmbientCapabilities=CAP_DAC_READ_SEARCH
ExecStartPre=-/bin/bash -c "chown -R {{ splunk_forwarder_user }}:{{ splunk_forwarder_group }} {{ splunk_home }}"
Delegate=true
CPUShares=1024
MemoryLimit=8170147840
PermissionsStartOnly=true
ExecStartPost=-/bin/bash -c "chown -R {{ splunk_forwarder_user }}:{{ splunk_forwarder_group }} /sys/fs/cgroup/cpu/system.slice/%n"
ExecStartPost=-/bin/bash -c "chown -R {{ splunk_forwarder_user }}:{{ splunk_forwarder_group }} /sys/fs/cgroup/memory/system.slice/%n"

[Install]
WantedBy=multi-user.target
